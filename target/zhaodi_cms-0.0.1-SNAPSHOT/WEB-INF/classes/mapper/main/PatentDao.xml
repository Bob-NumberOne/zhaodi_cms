<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhaodi.custom.dao.PatentDao">
    <!--开启本mapper的namespace下的二级缓存-->
    <!--
        eviction:代表的是缓存回收策略，目前MyBatis提供以下策略。
        (1) LRU,最近最少使用的，一处最长时间不用的对象
        (2) FIFO,先进先出，按对象进入缓存的顺序来移除他们
        (3) SOFT,软引用，移除基于垃圾回收器状态和软引用规则的对象
        (4) WEAK,弱引用，更积极的移除基于垃圾收集器状态和弱引用规则的对象。这里采用的是LRU，
                移除最长时间不用的对形象

        flushInterval:刷新间隔时间，单位为毫秒，这里配置的是100秒刷新，如果你不配置它，那么当
        SQL被执行的时候才会去刷新缓存。

        size:引用数目，一个正整数，代表缓存最多可以存储多少个对象，不宜设置过大。设置过大会导致内存溢出。
        这里配置的是1024个对象

        readOnly:只读，意味着缓存数据只能读取而不能修改，这样设置的好处是我们可以快速读取缓存，缺点是我们没有
        办法修改缓存，他的默认值是false，不允许我们修改
        <cache eviction="LRU" flushInterval="100000" readOnly="true" size="1024"/>
    -->
    <cache eviction="LRU" readOnly="true" size="1024"/>

    <!--信息查询 SELECT dqsqzqr,count(dqsqzqr) as total FROM uf_patentdata GROUP BY dqsqzqr-->
    <select id="getPatentAdded" resultType="com.zhaodi.custom.entity.InnovationJournal">
        SELECT
        DQSQZQR,COUNT(DQSQZQR) AS TOTAL
        FROM uf_patentdata
        <if test="block !=null and block.size()>0">
            where ssfl in
            <foreach item="item" index="index" collection="block" open="(" separator="," close=")">
                ${item}
            </foreach>
        </if>
        GROUP BY DQSQZQR
        <if test="companyName !=null and companyName.size()>0">
            HAVING DQSQZQR IN
            <foreach item="item" index="index" collection="companyName" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        ORDER BY TOTAL DESC,DQSQZQR
        <if test="isASC==1 ">
            LIMIT 0,#{top}
        </if>

    </select>
    <!--气泡图查询结构-->
    <select id="getEffectBubble" resultType="java.util.HashMap" >
        select fk as jg,jsxg as xg,count(*) as num
        from uf_patentdata where jsxg!='' and CHAR_LENGTH(jsxg)<![CDATA[ <= ]]>15
        <if test="block !=null and block.size()>0">
            and ssfl in
            <foreach item="item" index="index" collection="block" open="(" separator="," close=")">
                ${item}
            </foreach>
        </if>
        GROUP BY fk,jsxg
    </select>
    <!--查询专利申请摘要（词云统计）-->
    <select id="getParticiple" resultType="com.zhaodi.custom.entity.InnovationJournal" >
        SELECT zy
        FROM uf_patentdata
    </select>
    <!--查询专利申请方向大类-->
    <select id="getDirClass" resultType="java.util.HashMap">
         SELECT b.className,a.ssfl FROM uf_patentdata a
        LEFT JOIN uf_classification b on a.ssfl=b.id
        GROUP BY b.className,a.ssfl
    </select>
    <!--查询专利申请方向大类最多的前十条-->
    <select id="getTopTen" resultType="com.zhaodi.custom.entity.InnovationJournal" >
        SELECT
        dqsqzqr,count(ssfl) as total
        FROM uf_patentdata
        where 1=1
        <if test="tree !=null and tree.size()>0">
            and ssfl IN
            <foreach item="item" index="index" collection="tree" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        GROUP BY dqsqzqr
        ORDER BY total DESC,dqsqzqr
        LIMIT 0,10
    </select>
    <!--根据申请人和分类查找具体对应的申请条数-->
    <select id="getParticular" resultType="int">
        select count(id)  as total from uf_patentdata
        where dqsqzqr=#{applicant}
        <if test="tree !=null and tree.size()>0">
            and ssfl IN
            <foreach item="item" index="index" collection="tree" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
    </select>
    <!--根据分类id查出该分类中某公司最大值-->
    <select id="getTopOne" resultType="int">
        select  count(id) as maxNum from uf_patentdata
        where 1=1
        <if test="tree !=null and tree.size()>0">
            and ssfl IN
            <foreach item="item" index="index" collection="tree" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        GROUP BY dqsqzqr
        ORDER BY count(id) DESC
        LIMIT 0,1
    </select>

    <!--select t.column_name from information_schema.columns t where t.table_name='uf_patentdata';-->
    <select id="getWordsByName" resultType="int">
        select t.column_name from information_schema.columns t where t.table_name='uf_patentdata'
    </select>

    <!--存储专利对应数据-->
    <insert id="savePatentData" parameterType="com.zhaodi.custom.entity.InnovationJournal">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 14 15:38:07 CST 2020.
        -->
        insert into uf_patentdata (gkh,
        sqh, bt, dqsqzqr, fmr,
        sqny, fk, bz, ipcflh,
        locflh, sqr, gkr, sqrr,
        yyzl, yxqgj, yxqh,
        yxqr, dqsq, dljg, dlr,
        flztsj, flztgx, dqsqzlq,
        kztzyy, kztzcy, kztz,
        yssq, zllx, byyzl,
        slj, ipczflh, byyzls,
        yyzlsl, jdtzbyy, jdtzcy,
        jdtz, ssfl, img_url,
        file_url, creatTime, creater,
        updateTime, updateTer, zy,
        qlyq, dlql,creatName,bigClass,jswt,jssd,jsxg,status)
        values (#{data.gkh},
        #{data.sqh}, #{data.bt}, #{data.dqsqzqr}, #{data.fmr},
        #{data.sqny}, #{data.fk}, #{data.bz}, #{data.ipcflh},
        #{data.locflh}, #{data.sqr}, #{data.gkr}, #{data.sqrr},
        #{data.yyzl}, #{data.yxqgj}, #{data.yxqh},
        #{data.yxqr}, #{data.dqsq}, #{data.dljg}, #{data.dlr},
        #{data.flztsj}, #{data.flztgx}, #{data.dqsqzlq},
        #{data.kztzyy}, #{data.kztzcy}, #{data.kztz},
        #{data.yssq}, #{data.zllx}, #{data.byyzl},
        #{data.slj}, #{data.ipczflh}, #{data.byyzls},
        #{data.yyzlsl}, #{data.jdtzbyy}, #{data.jdtzcy},
        #{data.jdtz}, #{data.ssfl}, #{data.img_url},
        #{data.file_url}, #{data.creatTime}, #{data.creater},
        #{data.updateTime}, #{data.updateTer}, #{data.zy},
        #{data.qlyq}, #{data.dlql}, #{data.creatName}, #{data.bigClass},
        #{data.jswt}, #{data.jssd}, #{data.jsxg}, #{data.status})
    </insert>
    <!--根据模块获取路径-->
    <select id="getFileUrl" resultType="com.zhaodi.custom.entity.SysCatalog">
        SELECT id, server_url, mode_url, createTime, creater, updateTime, updater, mode_id
        FROM sys_catalog
        where mode_id=#{modeId}
        LIMIT 0,1
    </select>
    <!--根据条件获取数据-->
    <select id="getPatentData" resultType="com.zhaodi.custom.entity.InnovationJournal" parameterType="com.zhaodi.bean.Page">
        SELECT id, gkh, sqh, bt, dqsqzqr, fmr, sqny, fk, bz, ipcflh, locflh, sqr, gkr, sqrr, yyzl,
            yxqgj, yxqh, yxqr, dqsq, dljg, dlr, flztsj, flztgx, dqsqzlq, kztzyy, kztzcy, kztz,
            yssq, zllx, byyzl, slj, ipczflh, byyzls, yyzlsl, jdtzbyy, jdtzcy, jdtz, ssfl, img_url,
            file_url, creatTime, creater, updateTime, updateTer,creatName
        from uf_patentdata
        <where>
            status=1
            <if test="page.bean.id != null and page.bean.id != 0">
                AND id=#{page.bean.id}
            </if>
            <if test="page.bean.gkh != null">
                AND gkh LIKE CONCAT("%",#{page.bean.gkh},"%")
            </if>
            <if test="page.bean.sqh != null">
                AND sqh LIKE CONCAT("%",#{page.bean.sqh},"%")
            </if>
            <if test="page.bean.bt != null">
                AND bt LIKE CONCAT("%",#{page.bean.bt},"%")
            </if>
            <if test="page.bean.fmr != null">
                AND fmr LIKE CONCAT("%",#{page.bean.fmr},"%")
            </if>
            <if test="page.bean.fk != null">
                AND fk LIKE CONCAT("%",#{page.bean.fk},"%")
            </if>
            <if test="page.bean.bz != null">
                AND bz LIKE CONCAT("%",#{page.bean.bz},"%")
            </if>
            <if test="page.bean.ipcflh != null">
                AND ipcflh LIKE CONCAT("%",#{page.bean.ipcflh},"%")
            </if>
            <if test="page.bean.locflh != null">
                AND locflh LIKE CONCAT("%",#{page.bean.locflh},"%")
            </if>
            <if test="page.bean.sqr != null">
                AND sqr LIKE CONCAT("%",#{page.bean.sqr},"%")
            </if>
            <if test="page.bean.gkr != null">
                AND gkr LIKE CONCAT("%",#{page.bean.gkr},"%")
            </if>
            <if test="page.bean.sqrr != null">
                AND sqrr LIKE CONCAT("%",#{page.bean.sqrr},"%")
            </if>
            <if test="page.bean.yyzl != null">
                AND yyzl LIKE CONCAT("%",#{page.bean.yyzl},"%")
            </if>
            <if test="page.bean.yxqgj != null">
                AND yxqgj LIKE CONCAT("%",#{page.bean.yxqgj},"%")
            </if>
            <if test="page.bean.yxqh != null">
                AND yxqh LIKE CONCAT("%",#{page.bean.yxqh},"%")
            </if>
            <if test="page.bean.yxqr != null">
                AND yxqr LIKE CONCAT("%",#{page.bean.yxqr},"%")
            </if>
            <if test="page.bean.dqsq != null">
                AND dqsq LIKE CONCAT("%",#{page.bean.dqsq},"%")
            </if>
            <if test="page.bean.dljg != null">
                AND dljg LIKE CONCAT("%",#{page.bean.dljg},"%")
            </if>
            <if test="page.bean.dlr != null">
                AND dlr LIKE CONCAT("%",#{page.bean.dlr},"%")
            </if>
            <if test="page.bean.flztsj != null">
                AND flztsj LIKE CONCAT("%",#{page.bean.flztsj},"%")
            </if>
            <if test="page.bean.flztgx != null">
                AND flztgx LIKE CONCAT("%",#{page.bean.flztgx},"%")
            </if>
            <if test="page.bean.dqsqzlq != null">
                AND dqsqzlq LIKE CONCAT("%",#{page.bean.dqsqzlq},"%")
            </if>
            <if test="page.bean.kztzyy != null">
                AND kztzyy LIKE CONCAT("%",#{page.bean.kztzyy},"%")
            </if>
            <if test="page.bean.kztzcy != null">
                AND kztzcy LIKE CONCAT("%",#{page.bean.kztzcy},"%")
            </if>
            <if test="page.bean.kztz != null">
                AND kztz LIKE CONCAT("%",#{page.bean.kztz},"%")
            </if>
            <if test="page.bean.yssq != null">
                AND yssq LIKE CONCAT("%",#{page.bean.yssq},"%")
            </if>
            <if test="page.bean.zllx != null">
                AND zllx LIKE CONCAT("%",#{page.bean.zllx},"%")
            </if>
            <if test="page.bean.byyzl != null">
                AND byyzl LIKE CONCAT("%",#{page.bean.byyzl},"%")
            </if>
            <if test="page.bean.slj != null">
                AND slj LIKE CONCAT("%",#{page.bean.slj},"%")
            </if>
            <if test="page.bean.ipczflh != null">
                AND ipczflh LIKE CONCAT("%",#{page.bean.ipczflh},"%")
            </if>
            <if test="page.bean.byyzls != null">
                AND byyzls LIKE CONCAT("%",#{page.bean.byyzls},"%")
            </if>
            <if test="page.bean.yyzlsl != null">
                AND yyzlsl LIKE CONCAT("%",#{page.bean.yyzlsl},"%")
            </if>
            <if test="page.bean.jdtzbyy != null">
                AND jdtzbyy LIKE CONCAT("%",#{page.bean.jdtzbyy},"%")
            </if>
            <if test="page.bean.jdtzcy != null">
                AND jdtzcy LIKE CONCAT("%",#{page.bean.jdtzcy},"%")
            </if>
            <if test="page.bean.jdtz != null">
                AND jdtz LIKE CONCAT("%",#{page.bean.jdtz},"%")
            </if>
            <if test="page.bean.ssfl != null">
                AND ssfl LIKE CONCAT("%",#{page.bean.ssfl},"%")
            </if>
            <if test="page.bean.img_url != null">
                AND img_url LIKE CONCAT("%",#{page.bean.img_url},"%")
            </if>
            <if test="page.bean.file_url != null">
                AND file_url LIKE CONCAT("%",#{page.bean.file_url},"%")
            </if>
            <if test="page.bean.creatTime != null">
                AND creatTime LIKE CONCAT("%",#{page.bean.creatTime},"%")
            </if>
            <if test="page.bean.creater != null and page.bean.creater != 0">
                AND creater=#{page.bean.creater}
            </if>
            <if test="page.bean.updateTime != null">
                AND updateTime LIKE CONCAT("%",#{page.bean.updateTime},"%")
            </if>
            <if test="page.bean.updateTer != null and page.bean.updateTer != 0">
                AND updateTer=#{page.bean.updateTer}
            </if>
            <if test="page.bean.zy != null">
                AND zy LIKE CONCAT("%",#{page.bean.zy},"%")
            </if>
            <if test="page.bean.qlyq != null">
                AND qlyq LIKE CONCAT("%",#{page.bean.qlyq},"%")
            </if>
            <if test="page.bean.dlql != null">
                AND dlql LIKE CONCAT("%",#{page.bean.dlql},"%")
            </if>
            <if test="page.bean.creatName != null">
                AND creatName LIKE CONCAT("%",#{page.bean.creatName},"%")
            </if>
            <if test="companyName !=null and companyName.size()>0">
                AND DQSQZQR IN
                <foreach item="item" index="index" collection="companyName" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="startYear !=null and startYear !=''">
                <![CDATA[ and YEAR(STR_TO_DATE(sqny, '%Y-%m')) >= #{startYear} ]]>
            </if>
            <if test="endYear !=null and endYear !=''">
                <![CDATA[ and YEAR(STR_TO_DATE(sqny, '%Y-%m')) <= #{endYear} ]]>
            </if>
            <if test="page.bean.belongToBlock != null and page.bean.belongToBlock != '' ">
                AND ssfl in (${page.bean.belongToBlock})
            </if>
        </where>
        LIMIT #{page.start},#{page.pageSize}
    </select>
    <!--获取条数-->
    <select id="getPatentDataCounts" resultType="int" parameterType="com.zhaodi.bean.Page">
        SELECT count(id)
        from uf_patentdata
        <where>
            status=1
            <if test="page.bean.id != null and page.bean.id != 0">
                AND id=#{page.bean.id}
            </if>
            <if test="page.bean.gkh != null">
                AND gkh LIKE CONCAT("%",#{page.bean.gkh},"%")
            </if>
            <if test="page.bean.sqh != null">
                AND sqh LIKE CONCAT("%",#{page.bean.sqh},"%")
            </if>
            <if test="page.bean.bt != null">
                AND bt LIKE CONCAT("%",#{page.bean.bt},"%")
            </if>
            <if test="page.bean.fmr != null">
                AND fmr LIKE CONCAT("%",#{page.bean.fmr},"%")
            </if>
            <if test="page.bean.fk != null">
                AND fk LIKE CONCAT("%",#{page.bean.fk},"%")
            </if>
            <if test="page.bean.bz != null">
                AND bz LIKE CONCAT("%",#{page.bean.bz},"%")
            </if>
            <if test="page.bean.ipcflh != null">
                AND ipcflh LIKE CONCAT("%",#{page.bean.ipcflh},"%")
            </if>
            <if test="page.bean.locflh != null">
                AND locflh LIKE CONCAT("%",#{page.bean.locflh},"%")
            </if>
            <if test="page.bean.sqr != null">
                AND sqr LIKE CONCAT("%",#{page.bean.sqr},"%")
            </if>
            <if test="page.bean.gkr != null">
                AND gkr LIKE CONCAT("%",#{page.bean.gkr},"%")
            </if>
            <if test="page.bean.sqrr != null">
                AND sqrr LIKE CONCAT("%",#{page.bean.sqrr},"%")
            </if>
            <if test="page.bean.yyzl != null">
                AND yyzl LIKE CONCAT("%",#{page.bean.yyzl},"%")
            </if>
            <if test="page.bean.yxqgj != null">
                AND yxqgj LIKE CONCAT("%",#{page.bean.yxqgj},"%")
            </if>
            <if test="page.bean.yxqh != null">
                AND yxqh LIKE CONCAT("%",#{page.bean.yxqh},"%")
            </if>
            <if test="page.bean.yxqr != null">
                AND yxqr LIKE CONCAT("%",#{page.bean.yxqr},"%")
            </if>
            <if test="page.bean.dqsq != null">
                AND dqsq LIKE CONCAT("%",#{page.bean.dqsq},"%")
            </if>
            <if test="page.bean.dljg != null">
                AND dljg LIKE CONCAT("%",#{page.bean.dljg},"%")
            </if>
            <if test="page.bean.dlr != null">
                AND dlr LIKE CONCAT("%",#{page.bean.dlr},"%")
            </if>
            <if test="page.bean.flztsj != null">
                AND flztsj LIKE CONCAT("%",#{page.bean.flztsj},"%")
            </if>
            <if test="page.bean.flztgx != null">
                AND flztgx LIKE CONCAT("%",#{page.bean.flztgx},"%")
            </if>
            <if test="page.bean.dqsqzlq != null">
                AND dqsqzlq LIKE CONCAT("%",#{page.bean.dqsqzlq},"%")
            </if>
            <if test="page.bean.kztzyy != null">
                AND kztzyy LIKE CONCAT("%",#{page.bean.kztzyy},"%")
            </if>
            <if test="page.bean.kztzcy != null">
                AND kztzcy LIKE CONCAT("%",#{page.bean.kztzcy},"%")
            </if>
            <if test="page.bean.kztz != null">
                AND kztz LIKE CONCAT("%",#{page.bean.kztz},"%")
            </if>
            <if test="page.bean.yssq != null">
                AND yssq LIKE CONCAT("%",#{page.bean.yssq},"%")
            </if>
            <if test="page.bean.zllx != null">
                AND zllx LIKE CONCAT("%",#{page.bean.zllx},"%")
            </if>
            <if test="page.bean.byyzl != null">
                AND byyzl LIKE CONCAT("%",#{page.bean.byyzl},"%")
            </if>
            <if test="page.bean.slj != null">
                AND slj LIKE CONCAT("%",#{page.bean.slj},"%")
            </if>
            <if test="page.bean.ipczflh != null">
                AND ipczflh LIKE CONCAT("%",#{page.bean.ipczflh},"%")
            </if>
            <if test="page.bean.byyzls != null">
                AND byyzls LIKE CONCAT("%",#{page.bean.byyzls},"%")
            </if>
            <if test="page.bean.yyzlsl != null">
                AND yyzlsl LIKE CONCAT("%",#{page.bean.yyzlsl},"%")
            </if>
            <if test="page.bean.jdtzbyy != null">
                AND jdtzbyy LIKE CONCAT("%",#{page.bean.jdtzbyy},"%")
            </if>
            <if test="page.bean.jdtzcy != null">
                AND jdtzcy LIKE CONCAT("%",#{page.bean.jdtzcy},"%")
            </if>
            <if test="page.bean.jdtz != null">
                AND jdtz LIKE CONCAT("%",#{page.bean.jdtz},"%")
            </if>
            <if test="page.bean.ssfl != null">
                AND ssfl LIKE CONCAT("%",#{page.bean.ssfl},"%")
            </if>
            <if test="page.bean.img_url != null">
                AND img_url LIKE CONCAT("%",#{page.bean.img_url},"%")
            </if>
            <if test="page.bean.file_url != null">
                AND file_url LIKE CONCAT("%",#{page.bean.file_url},"%")
            </if>
            <if test="page.bean.creatTime != null">
                AND creatTime LIKE CONCAT("%",#{page.bean.creatTime},"%")
            </if>
            <if test="page.bean.creater != null and page.bean.creater != 0">
                AND creater=#{page.bean.creater}
            </if>
            <if test="page.bean.updateTime != null">
                AND updateTime LIKE CONCAT("%",#{page.bean.updateTime},"%")
            </if>
            <if test="page.bean.updateTer != null and page.bean.updateTer != 0">
                AND updateTer=#{page.bean.updateTer}
            </if>
            <if test="page.bean.zy != null">
                AND zy LIKE CONCAT("%",#{page.bean.zy},"%")
            </if>
            <if test="page.bean.qlyq != null">
                AND qlyq LIKE CONCAT("%",#{page.bean.qlyq},"%")
            </if>
            <if test="page.bean.dlql != null">
                AND dlql LIKE CONCAT("%",#{page.bean.dlql},"%")
            </if>
            <if test="page.bean.creatName != null">
                AND creatName LIKE CONCAT("%",#{page.bean.creatName},"%")
            </if>
            <if test="companyName !=null and companyName.size()>0">
                AND DQSQZQR IN
                <foreach item="item" index="index" collection="companyName" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="startYear !=null and startYear !=''">
                <![CDATA[ and YEAR(STR_TO_DATE(sqny, '%Y-%m')) >= #{startYear} ]]>
            </if>
            <if test="endYear !=null and endYear !=''">
                <![CDATA[ and YEAR(STR_TO_DATE(sqny, '%Y-%m')) <= #{endYear} ]]>
            </if>
            <if test="page.bean.belongToBlock != null and page.bean.belongToBlock != '' ">
                AND ssfl in (${page.bean.belongToBlock})
            </if>
        </where>
    </select>

    <!--专利申请人月数据-->
    <select id="getMonthOfPatent" resultType="java.util.HashMap" >
         SELECT dqsqzqr,count(dqsqzqr) as total
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=1  then 1 else 0 end) as 'month1'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=2  then 1 else 0 end) as 'month2'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=3  then 1 else 0 end) as 'month3'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=4  then 1 else 0 end) as 'month4'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=5  then 1 else 0 end) as 'month5'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=6  then 1 else 0 end) as 'month6'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=7  then 1 else 0 end) as 'month7'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=8  then 1 else 0 end) as 'month8'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=9  then 1 else 0 end) as 'month9'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=10  then 1 else 0 end) as 'month10'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=11  then 1 else 0 end) as 'month11'
        ,SUM(case when MONTH(STR_TO_DATE(sqr, '%Y-%m-%d'))=12  then 1 else 0 end) as 'month12'
        FROM uf_patentdata
        where 1=1
        <if test="sw.company !=null and sw.company.size()>0">
            and dqsqzqr IN
            <foreach item="item" index="index" collection="sw.company" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="sw.year !=null and sw.year !=''">
            and sqr LIKE CONCAT("%",#{sw.year},"%")
        </if>
        <if test="sw.belongToBlock !=null and sw.belongToBlock !=''">
            and ssfl in (${sw.belongToBlock})
        </if>
        GROUP BY dqsqzqr
        ORDER BY count(dqsqzqr) DESC,dqsqzqr
        LIMIT 0,#{sw.top}
    </select>
    <!--动态获取专利年份-->
    <select id="getYears" resultType="String" >
        select DISTINCT YEAR(STR_TO_DATE(sqr, '%Y-%m-%d')) as years
        from uf_patentdata
        where 1=1
        <if test="startYear !=null and startYear !=''">
            <![CDATA[ and YEAR(STR_TO_DATE(sqr, '%Y-%m-%d')) >= #{startYear} ]]>
        </if>
        <if test="endYear !=null and endYear !=''">
            <![CDATA[ and YEAR(STR_TO_DATE(sqr, '%Y-%m-%d')) <= #{endYear} ]]>
        </if>
        ORDER BY years ASC
    </select>

    <select id="getYearOfPatent" resultType="java.util.HashMap" >
        SELECT dqsqzqr,count(dqsqzqr) as total
        <if test="listYear.size()>0">
            <foreach item="item" index="index" collection="listYear" >
                ,SUM(case when YEAR(STR_TO_DATE(sqr, '%Y-%m-%d'))=#{item}  then 1 else 0 end) as #{item}
            </foreach>
        </if>
        FROM uf_patentdata
        where 1=1
        <if test="sw.company !=null and sw.company.size()>0">
            and DQSQZQR IN
            <foreach item="item" index="index" collection="sw.company" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="sw.startYear !=null and sw.startYear !=''">
            <![CDATA[ and YEAR(STR_TO_DATE(sqr, '%Y-%m-%d')) >= #{sw.startYear} ]]>
        </if>
        <if test="sw.endYear !=null and sw.endYear !=''">
            <![CDATA[ and YEAR(STR_TO_DATE(sqr, '%Y-%m-%d')) <= #{sw.endYear} ]]>
        </if>
        <if test="sw.belongToBlock !=null and sw.belongToBlock !=''">
            and ssfl in (${sw.belongToBlock})
        </if>
        GROUP BY dqsqzqr
        ORDER BY count(dqsqzqr) DESC,dqsqzqr
        LIMIT 0,#{sw.top}
    </select>
    <!--获取轮播图片-->
    <select id="getPicData" resultType="com.zhaodi.custom.entity.InnovationJournal">
        SELECT id,dqsqzqr,zy,gkh,img_url,bz
        FROM uf_patentdata
        where bz is not null and bz!='' and status=1
    </select>

    <!--分词过滤表==查询-->



    <select id="findPartWords" resultType="com.zhaodi.custom.entity.UfPatentdataWord">
        SELECT id, word,nature,updater,creater FROM uf_patentdata_word
        <where>
            status=1
            <if test="page.bean.id != null and page.bean.id != 0">
                AND id=#{page.bean.id}
            </if>
            <if test="page.bean.word != null and page.bean.word != ''" >
                AND word LIKE CONCAT("%",#{page.bean.word},"%")
            </if>
            <if test="page.bean.nature != null and page.bean.nature != ''">
                AND nature LIKE CONCAT("%",#{page.bean.nature},"%")
            </if>
            <if test="page.bean.updater != null and page.bean.updater != 0">
                AND updater=#{page.bean.updater}
            </if>
            <if test="page.bean.creater != null and page.bean.creater != 0">
                AND creater=#{page.bean.creater}
            </if>
        </where>
        LIMIT #{page.start},#{page.pageSize}
    </select>
    <select id="findPartWordsCounts" parameterType="com.zhaodi.custom.entity.UfPatentdataWord" resultType="int">
        SELECT count(id) FROM uf_patentdata_word
        <where>
            status=1
            <if test="page.bean.id != null and page.bean.id != 0">
                AND id=#{page.bean.id}
            </if>
            <if test="page.bean.word != null">
                AND word LIKE CONCAT("%",#{page.bean.word},"%")
            </if>
            <if test="page.bean.nature != null">
                AND nature LIKE CONCAT("%",#{page.bean.nature},"%")
            </if>
            <if test="page.bean.updater != null">
                AND updater=#{page.bean.updater}
            </if>
            <if test="page.bean.creater != null">
                AND creater=#{page.bean.creater}
            </if>
        </where>
    </select>

    <!--分词过滤表==插入-->
    <insert id="insertPartWords" parameterType="com.zhaodi.custom.entity.UfPatentdataWord">
        insert into uf_patentdata_word
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="word != null">
                word,
            </if>
            <if test="nature != null">
                nature,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="creater != null and creater != 0">
                creater,
            </if>
            <if test="creattime != null">
                creatTime,
            </if>
            <if test="updater != null and updater != 0">
                updater,
            </if>
            <if test="updatetime != null">
                updateTime,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="word != null">
                #{word,jdbcType=VARCHAR},
            </if>
            <if test="nature != null">
                #{nature,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                #{status,jdbcType=TINYINT},
            </if>
            <if test="creater != null and creater != 0">
                #{creater,jdbcType=BIGINT},
            </if>
            <if test="creattime != null">
                #{creattime,jdbcType=VARCHAR},
            </if>
            <if test="updater != null and updater != 0">
                #{updater,jdbcType=BIGINT},
            </if>
            <if test="updatetime != null">
                #{updatetime,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <!--分词过滤表==更新-->
    <update id="updatePartWords" parameterType="com.zhaodi.custom.entity.UfPatentdataWord">
        update uf_patentdata_word
        <set>
            <if test="word != null">
                word = #{word,jdbcType=VARCHAR},
            </if>
            <if test="nature != null">
                nature = #{nature,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=TINYINT},
            </if>
            <if test="creater != null  and creater != 0">
                creater = #{creater,jdbcType=BIGINT},
            </if>
            <if test="creattime != null">
                creatTime = #{creattime,jdbcType=VARCHAR},
            </if>
            <if test="updater != null and updater != 0">
                updater = #{updater,jdbcType=BIGINT},
            </if>
            <if test="updatetime != null">
                updateTime = #{updatetime,jdbcType=VARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>
    <!--分词过滤表==真删除-->
    <delete id="deletePartWordsF" parameterType="int">
        delete from uf_patentdata_word
        where id = #{id,jdbcType=BIGINT}
    </delete>
    <!--分词过滤表==软删除-->
    <update id="deletePartWordsT" parameterType="int">
        update uf_patentdata_word
        set status=0
        where id = #{id,jdbcType=BIGINT}
    </update>

    <select id="findWordOfCX" resultType="java.util.HashMap">
        select partName as title,partEnglish as value from uf_patentdata_part
    </select>
    <select id="findWordOfCol" resultType="java.util.HashMap">
        select ColumnName as title,ColumnEnglish as value from uf_patentdata_colname
    </select>

    <select id="findAllPartWords" resultType="com.zhaodi.custom.entity.UfPatentdataWord">
    SELECT id, word,nature FROM uf_patentdata_word where status=1
    </select>

    <!--查询专利申请摘要（词云统计）-->
    <select id="getParticipleWords" resultType="com.zhaodi.custom.entity.InnovationJournal" >
        SELECT
        <if test="ColName !=null and ColName.size()>0">
            <foreach item="item" index="index" collection="ColName" separator=",">
                ${item}
            </foreach>
        </if>
        FROM uf_patentdata where status=1
        <if test="block !=null and block.size()>0">
           and ssfl in
            <foreach item="item" index="index" collection="block" open="(" separator="," close=")">
                ${item}
            </foreach>
        </if>
    </select>

    <select id="findFilterWords" resultType="com.zhaodi.custom.entity.PatentFilterWord">
        SELECT id, word,nature
        FROM uf_patentdata_filterword
        where status=1
        LIMIT #{page.start},#{page.pageSize}
    </select>
    <select id="findFilterWords1" resultType="com.zhaodi.custom.entity.PatentFilterWord">
        SELECT id, word,nature
        FROM uf_patentdata_filterword
        where status=1
    </select>

    <delete id="deleteFilterWordsF" parameterType="int">
        delete from uf_patentdata_filterword
        where id = #{id}
    </delete>
    <update id="updateFilterWords" parameterType="com.zhaodi.custom.entity.PatentFilterWord">
        update uf_patentdata_filterword
        <set>
            <if test="word != null">
                word = #{word},
            </if>
            <if test="nature != null">
                nature = #{nature},
            </if>
        </set>
        where id = #{id}
    </update>
    <select id="findPartFilterCounts" parameterType="com.zhaodi.custom.entity.PatentFilterWord" resultType="int">
        SELECT count(id) FROM uf_patentdata_filterword where status=1
    </select>
    <insert id="insertFilterWords" parameterType="com.zhaodi.custom.entity.PatentFilterWord">
        insert into uf_patentdata_filterword
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="word != null">
                word,
            </if>
            <if test="nature != null">
                nature,
            </if>
            <if test="status != null">
                status,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="word != null">
                #{word},
            </if>
            <if test="nature != null">
                #{nature},
            </if>
            <if test="status != null">
                #{status},
            </if>
        </trim>
    </insert>
    <select id="countDuplicateNumber" parameterType="string" resultType="int">
        select count(id) from uf_patentdata where gkh=#{gkh}
    </select>

</mapper>